{% extends 'auth/base_auth.html' %}

{% block title %}Registro de Paciente - Sistema de Gestión de Citas{% endblock %}

{% block auth_title %}Registro{% endblock %}

{% block auth_content %}
<form method="post" action="{% url 'registro' %}" class="registro-form">
    {% csrf_token %}
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="nombres" class="form-label">Nombres</label>
            <input type="text" class="form-control" id="nombres" name="nombres" placeholder="Ingrese sus nombres" required>
        </div>
        <div class="col-md-6 mb-3">
            <label for="apellidos" class="form-label">Apellidos</label>
            <input type="text" class="form-control" id="apellidos" name="apellidos" placeholder="Ingrese sus apellidos" required>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="dni" class="form-label">DNI</label>
            <input type="text" class="form-control" id="dni" name="dni" placeholder="Ingrese su DNI (8 dígitos)" maxlength="8" required>
            <div class="form-text">Su DNI será su nombre de usuario para iniciar sesión</div>
        </div>
        <div class="col-md-6 mb-3">
            <label for="fecha_nacimiento" class="form-label">Fecha de Nacimiento</label>
            <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento" required>
        </div>
    </div>
    
    <div class="mb-3">
        <label for="email" class="form-label">Correo Electrónico</label>
        <input type="email" class="form-control" id="email" name="email" placeholder="ejemplo@correo.com" required>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="sexo" class="form-label">Sexo</label>
            <select class="form-select" id="sexo" name="sexo" required>
                <option value="" selected disabled>Seleccione una opción</option>
                <option value="M">Masculino</option>
                <option value="F">Femenino</option>
                <option value="O">Otro</option>
            </select>
        </div>
        <div class="col-md-6 mb-3">
            <label for="rol" class="form-label">Rol en el Sistema</label>
            <select class="form-select" id="rol" name="rol" required>
                <option value="" selected disabled>Seleccione un rol</option>
                <option value="Paciente">Paciente</option>
                <option value="Medico">Médico</option>
                <option value="Admision">Admisión</option>
                <option value="Administrador">Administrador</option>
            </select>
        </div>
    </div>
    
    <!-- Campo de especialidad (visible solo cuando se selecciona Médico) -->
    <div class="row" id="especialidadContainer" style="display: none;">
        <div class="col-12 mb-3">
            <label for="especialidad" class="form-label">Especialidad Médica</label>
            <select class="form-select" id="especialidad" name="especialidad">
                <option value="" selected disabled>Seleccione una especialidad</option>
                {% for especialidad in especialidades %}
                <option value="{{ especialidad.id }}">{{ especialidad.nombre }}</option>
                {% endfor %}
            </select>
            <div class="form-text">Seleccione la especialidad médica a la que pertenece.</div>
        </div>
    </div>
    
    <div class="mb-3">
        <label for="telefono" class="form-label">Teléfono</label>
        <input type="tel" class="form-control" id="telefono" name="telefono" placeholder="Ingrese su número telefónico" required>
    </div>
    
    <div class="mb-3">
        <label for="direccion" class="form-label">Dirección</label>
        <textarea class="form-control" id="direccion" name="direccion" rows="2" placeholder="Ingrese su dirección completa" required></textarea>
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="password" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="password" name="password" placeholder="Ingrese su contraseña" required>
        </div>
        <div class="col-md-6 mb-3">
            <label for="password2" class="form-label">Confirmar Contraseña</label>
            <input type="password" class="form-control" id="password2" name="password2" placeholder="Confirme su contraseña" required>
        </div>
    </div>
    
    <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="terminos" name="terminos" required>
        <label class="form-check-label" for="terminos">Acepto los términos y condiciones</label>
    </div>
    
    <div class="d-grid gap-2">
        <button type="submit" class="btn btn-auth">
            <i class="fas fa-user-plus me-2"></i>Registrarme
        </button>
    </div>
    
    <p class="mt-3 text-center">
        ¿Ya tienes una cuenta? <a href="{% url 'login' %}">Inicia sesión aquí</a>
    </p>
</form>

<script>
    // JavaScript para mostrar/ocultar el campo de especialidad según el rol seleccionado
    document.addEventListener('DOMContentLoaded', function() {
        const rolSelect = document.getElementById('rol');
        const especialidadContainer = document.getElementById('especialidadContainer');
        const especialidadSelect = document.getElementById('especialidad');
        
        // Función para mostrar/ocultar el campo de especialidad
        function toggleEspecialidadField() {
            if (rolSelect.value === 'Medico') {
                especialidadContainer.style.display = 'block';
                especialidadSelect.setAttribute('required', 'required');
            } else {
                especialidadContainer.style.display = 'none';
                especialidadSelect.removeAttribute('required');
            }
        }
        
        // Verificar el estado inicial
        toggleEspecialidadField();
        
        // Agregar evento change al select de rol
        rolSelect.addEventListener('change', toggleEspecialidadField);
    });
</script>
{% endblock %}

{% block auth_footer %}
<p class="mb-0">Al registrarte, podrás reservar citas médicas y acceder a tu historial clínico</p>
{% endblock %}
